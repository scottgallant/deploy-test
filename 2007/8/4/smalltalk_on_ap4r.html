<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>paperplanes. Smalltalk on AP4R</title>
    <meta name="robots" content="index,follow"/>
    <meta name="mssmarttagspreventparsing" content="true"/>
    <link rel="shortcut icon" href="/images/favicon.gif" type="image/gif" />
    <link rel="icon" href="/images/favicon.gif" type="image/gif" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  	<meta name="author" content="Mathias Meyer"/>
    <meta name="dc.title" content="paperplanes. Smalltalk on AP4R"/>
  	<link rel="start" href="http://www.paperplanes.de" title="paperplanes"/>
     
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="Smalltalk on AP4R"/>
    <meta name="twitter:site" content="@roidrage"/>
    <meta name="twitter:creator" content="@roidrage"/>
    <meta name="twitter:description" content="After playing around with AP4R, the new kid on the asynchronous Ruby block, for a little while, I held a small presentation at last week&#39;s meeting of the Ruby User Group Berlin. While it is mor..."/>
    <meta name="twitter:url" content="http://www.paperplanes.de/2007/8/4/smalltalk_on_ap4r.html"/>
    <meta name="twitter:domain" content="paperplanes.de"/>
    
    <link href="http://www.paperplanes.de/rss.xml" rel="alternate" title="Primary Feed" type="application/rss+xml" />
    <link href="/stylesheets/screen.css" media="screen" rel="Stylesheet" title="paperplanes" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css" media="handheld, only screen and (max-device-width: 960px)" />
  </head>
  
  <body id="www-paperplanes-de">
    <div id="head">
      <div id="header-content">
        <a href="/">
          <img src="/images/paperplane.png" id="paperplane">
        </a>
        <div id="about">
          <h1 class="default">Hi, I'm Mathias Meyer, nice to meet you!</h1>
          <h1 class="mobile">Hi, I'm <a href="https://twitter.com/roidrage">Mathias Meyer</a>, I'm the CEO at <a href="https://travis-ci.com">Travis CI</a></h1>
          <p style="color: white" class="about-sub-title default">
            I'm the CEO at <a href="http://travis-ci.com">Travis CI</a>. I like coffee, <a href="https://twitter.com/roidrage">Twitter</a> and <a href="mailto:meyer@paperplanes.de">email</a>.
          </p>
        </div>
      </div>
    </div>

    <div id="box">
      <div id="content">
        <article class="hentry">
  <div class="item_perma">
    <div class="item_details">
      <header>
        <h3 class="entry-title">Smalltalk on AP4R</h3>
        <h4><a href="/2007/8/4/smalltalk_on_ap4r.html" title="Permalink for this post">04 August 2007</a> by <a href="http://twitter.com/roidrage">Mathias Meyer</a></h4>
      </header>
    </div>
    <div class="item_content">
      <p>After playing around with <a href="http://ap4r.rubyforge.org/wiki/wiki.pl?HomePage">AP4R</a>, the new kid on the asynchronous Ruby block, for a little while, I held a small presentation at last week&#39;s meeting of the <a href="http://www.rug-b.com">Ruby User Group Berlin</a>. While it is more of an introduction than a field report I put up the <a href="http://www.paperplanes.de/files/AP4R.pdf">slides as PDF</a> anyway.</p>

<p>One note on the load balancing though. That&#39;s the issue that brought up some questions I couldn&#39;t answer, so I had another look at the documentation (which is still rather sparse, by the way.</p>

<p>AP4R knows two kinds of balancing. The first one is the distribution of dispatching tasks over a number of threads. That way the messages in the server&#39;s queue can be handled in parallel. Since the threads only scale on one host this doesn&#39;t allow for load balancing on several hosts.</p>

<p>For this AP4R has an experimental feature called <a href="http://viewvc.rubyforge.mmmultiworks.com/cgi/viewvc.cgi/trunk/ap4r/lib/ap4r/carrier.rb?root=ap4r&amp;view=markup">carriers</a>. These allow for the AP4R server to redistribute the messages to a bunch of servers exclusively dealing with the messages. It should be added though that these carriers use polling to fetch new messages from the master server&#39;s queue. This has the clear advantage that new carriers can be added without changing any configuration on the other servers. Carriers aren&#39;t considered stable yet, but they point in the right direction.</p>

<p>As for the client, let&#39;s say a Rails application, it can only handle exactly one AP4R server to transmit its messages to. So if you&#39;re balancing your application&#39;s load over several servers, you can either send all the messages to one server or have each application deliver them to its own AP4R server. The downside of this is that if one server fails, one or all of your server can&#39;t deliver asynchronous messages. So it&#39;s probably best to always rely on store-and-forward to ensure that your messages won&#39;t get lost.</p>

<p>For some further information I&#39;d recommend checking out the website, the <a href="http://ap4r.rubyforge.org/wiki/wiki.pl?GettingStarted#Monitoring">&quot;Getting Started&quot;</a> document, where they show how to set up the example application, and a <a href="http://rubyforge.org/docman/view.php/1765/1257/AP4R_on_RubyKaigi2007_EN.pdf">large set of slides</a> from a presentation at this year&#39;s RubyKaigi.</p>

<p>I&#39;m looking forward to seeing what&#39;s next for AP4R. It&#39;s a promising start.</p>

    </div>
    <div class="item_meta">
      <div class="item_tags">Tags:
        
      </div>
      <div class="item_hierarchy">Hierarchy:
        
          <a href="/2007/8/3/random_friday_links.html" title="Previous post">previous</a>
        
        
        
          , <a href="/2007/8/22/continuous_integration_for_ruby_and.html" title="Next post">next</a>
        
        </div>
    </div>
  </div>
</article>

       
        <div id="footer">
          <div id="footer_text">
            <a href="/archives.html">Archives</a>, <a href="http://www.paperplanes.de/rss.xml" title="Full-text RSS feed">RSS Feed</a>, &copy; 2007-2014 Mathias Meyer <a href="/imprint.html">Imprint</a>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46305173-1', 'paperplanes.de');
      ga('send', 'pageview');

    </script>
  </body>
  <script src="//my.hellobar.com/7db1d1ae6111ae95568efbbf8e6a1ee953ad854f.js" type="text/javascript" charset="utf-8" async="async"></script>
</html>
