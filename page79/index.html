<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>paperplanes. mathias meyer.</title>
    <meta name="robots" content="index,follow"/>
    <meta name="mssmarttagspreventparsing" content="true"/>
    <link rel="shortcut icon" href="/images/favicon.gif" type="image/gif" />
    <link rel="icon" href="/images/favicon.gif" type="image/gif" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  	<meta name="author" content="Mathias Meyer"/>
    <meta name="dc.title" content="paperplanes. mathias meyer."/>
  	<link rel="start" href="http://www.paperplanes.de" title="paperplanes"/>
    
    <link href="http://www.paperplanes.de/rss.xml" rel="alternate" title="Primary Feed" type="application/rss+xml" />
    <link href="/stylesheets/screen.css" media="screen" rel="Stylesheet" title="paperplanes" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/mobile.css" media="handheld, only screen and (max-device-width: 960px)" />
  </head>
  
  <body id="www-paperplanes-de">
    <div id="head">
      <div id="header-content">
        <a href="/">
          <img src="/images/paperplane.png" id="paperplane">
        </a>
        <div id="about">
          <h1 class="default">Hi, I'm Mathias Meyer, nice to meet you!</h1>
          <h1 class="mobile">Hi, I'm <a href="https://twitter.com/roidrage">Mathias Meyer</a>, I'm the CEO at <a href="https://travis-ci.com">Travis CI</a></h1>
          <p style="color: white" class="about-sub-title default">
            I'm the CEO at <a href="http://travis-ci.com">Travis CI</a>. I like coffee, <a href="https://twitter.com/roidrage">Twitter</a> and <a href="mailto:meyer@paperplanes.de">email</a>.
          </p>
        </div>
      </div>
    </div>

    <div id="box">
      <div id="content">
        <div id="articles">

  <article>
    <div class="item">
      <div class="item_details">
        <h3><a href="/2007/8/24/storing_images_with_oracle_and.html">Storing Images with Oracle and Hibernate</a></h3>
        <h4><a href="/2007/8/24/storing_images_with_oracle_and.html" title="Storing Images with Oracle and Hibernate">24 August 2007</a> by <a href="http://twitter.com/roidrage">Mathias Meyer</a></h4>
      </div>
      <div class="item_content">
        <p>All I wanted was to store images in the database through Hibernate. It all look so easy. Add a byte array property, add it as a binary type to the Hibernate mapping and off you go. So far so good. I&#39;m developing with MySQL where everything worked the way it&#39;s supposed to. Image data goes into the database and comes out when required, no problem.</p>

<p>Enter Oracle. The first fetching of data from the database worked like a charm, but the second brought up a nice ORA error. ORA-17027: Stream has already been closed. Good stuff. Digging through the result on Google it seems that I&#39;m not the only one having this problem. The Hibernate gang is quick enough to point out that the error lies with the Oracle JDBC driver. The problem is that a the default type for byte arrays with the OracleDialect is <code>long raw</code>. When a query is fired with a stream column (e.g. long raw) in the field list it has to be read last, or else the stream will be closed once the next column is read.</p>

<p>One suggestion was to put the corresponding column to the end of the mapping file, but that didn&#39;t work at all for me. Another one was to use a different JDBC driver. All that didn&#39;t work for me, but there had to be a way.</p>

<p>According to <a href="http://hansonchar.blogspot.com/">Hanson Char</a> the solution is to use a blob to store the byte array. Since you can&#39;t just set the type of the property to blob and be done with it, <a href="http://hansonchar.blogspot.com/2005_06_01_hansonchar_archive.html#111941318291641765">he offers</a> a simple solution: add blob handling to your model. I tried it and it works. The thing I didn&#39;t like about it was to have all that stuff from the JDBC packages in my model, so I tried to put it into a UserType. It does work to a certain extent, but since you don&#39;t have direct access to the session in it I couldn&#39;t implement everything Hibernate&#39;s own BlobType does. Respecting the hibernate.jdbc.use<em>streams</em>for_binary is probably the most important thing.</p>

<p>So I just derived a combination of Hanson&#39;s Code and Hibernate&#39;s BlobType wrapped it into a <a href="http://www.paperplanes.de/files/ByteBlobType.java">ByteBlobType</a>. It uses most of the BlobType implementation and only wraps the conversion between byte array and blob.</p>

<p>Just before I was done I had a look what kinds of subclasses of UserType lurks around in my project. It didn&#39;t really surprise me, but of course Spring offers a type to do just that, but Spring-style. Doh! It&#39;s called <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/orm/hibernate3/support/BlobByteArrayType.html">BlobByteArrayType</a>. Though it can be used as a normal Hibernate type, it needs an additional property set in your session factory provided by Spring&#39;s LocalSessionFactoryBean, a LobHandler. That&#39;s a no-brainer though and can be done quite easily:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text"> &lt;bean id=&quot;sessionFactory&quot;
      class=&quot;org.springframework.orm.hibernate3.LocalSessionFactoryBean&quot;&gt;
   .....
   &lt;property name=&quot;lobHandler&quot; ref=&quot;defaultLobHandler&quot;/&gt;
 &lt;/bean&gt;

 &lt;bean id=&quot;defaultLobHandler&quot; 
       class=&quot;org.springframework.jdbc.support.lob.DefaultLobHandler&quot;
       lazy-init=&quot;true&quot;/&gt;
</code></pre></div>
<p>That should work for most databases, of course not with all versions of Oracle. For the latter you&#39;re better off using the <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jdbc/support/lob/OracleLobHandler.html">OracleLobHandler</a>. The <a href="http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/jdbc/support/lob/DefaultLobHandler.html">default handler</a> works with Oracle 10g to a certain extent which I can confirm, but apparently not all of it. If you&#39;re not using Spring, then the above ByteBlobType might be an option for you.</p>

      </div>
      <div class="item_meta">
        <span class="item_tags">
          Tags: 
          
        </span>
      </div>
    </div>
  </article>

  <article>
    <div class="item">
      <div class="item_details">
        <h3><a href="/2007/8/23/random_rails_links.html">Random Rails Links</a></h3>
        <h4><a href="/2007/8/23/random_rails_links.html" title="Random Rails Links">23 August 2007</a> by <a href="http://twitter.com/roidrage">Mathias Meyer</a></h4>
      </div>
      <div class="item_content">
        <ul>
<li>Chad Fowler and Marcel Molina are holding a <a href="http://www.chadfowler.com/2007/8/21/railsconf-europe-full-day-testing-tutorial">full-day Rails testing tutorial</a> on the day before the sessions of RailsConf Europe. That would be September 17th. You&#39;re expected to fork over $75 for the entry, but fear not, the money is for a good cause and the donation is tax-deductible.</li>
<li>A while ago <a href="http://ola-bini.blogspot.com/2007/04/activehibernate-any-takers.html">Ola Bini called</a> for an implementation of <a href="http://www.hibernate.org">Hibernate</a> for <a href="http://jruby.codehaus.org/">JRuby</a>. <a href="http://rubymatic.blogspot.com/">Johan Andries</a> is giving it a try: <a href="http://code.google.com/p/activehibernate/">ActiveHibernate</a> on Google Code (via <a href="http://www.infoq.com/news/2007/08/jruby-active-hibernate">InfoQ</a>)</li>
<li>A year after the initial listing on their website, The Pragmatic Programmers announced <a href="http://pragmaticprogrammer.com/titles/fr_deploy/index.html">&quot;Deploying Rails Applications&quot;</a>. Written by Ezra Zygmuntowicz (of BackgrounDRb fame) and Bruce Tate it aims to offer all kinds of wisdom about running Rails applications in the wild. It&#39;s still in beta, but I know I&#39;m gonna grab a copy.</li>
<li>Adding time zones to a Rails application is something I was doing this week. Of great help were the <a href="http://weblog.jamisbuck.org/2007/2/2/introducing-tztime">introduction by Jamis Buck</a> and <a href="http://blog.caboo.se/articles/2007/2/23/adding-timezone-to-your-rails-app">an article by Courtenay of caboose fame</a></li>
</ul>

      </div>
      <div class="item_meta">
        <span class="item_tags">
          Tags: 
          
        </span>
      </div>
    </div>
  </article>

  <article>
    <div class="item">
      <div class="item_details">
        <h3><a href="/2007/8/22/continuous_integration_for_ruby_and.html">Continuous Integration for Ruby and Rails</a></h3>
        <h4><a href="/2007/8/22/continuous_integration_for_ruby_and.html" title="Continuous Integration for Ruby and Rails">22 August 2007</a> by <a href="http://twitter.com/roidrage">Mathias Meyer</a></h4>
      </div>
      <div class="item_content">
        <p>Due to some developers not so keen about running the tests I got back to my trusty friend Continuous Integration for a project I&#39;m currently working on. Being a big fan of CruiseControl I looked for similar solutions for the Rails and Ruby market. There are several tools you can use, and they have several ups and downs.</p>

<ul>
<li><p><strong>The Slim Solution</strong>: <a href="http://dev.rubyonrails.org/browser/plugins/continuous_builder">Continuous Builder</a><br>
A small application disguised as a Rails plugin which you can hook into your Subversion post-commit. It&#39;s part of the Rails repository and, though it hasn&#39;t been cared for in a while, still fulfils its purpose. The commit hook runs checks out the source and runs the tests. Should one or (<em>gasp</em>) several of them fail, it will bug you with a nice email pointing out the abounding problems. It&#39;s the simplest solution, but it needs a separate environment in your Rails application. Ryan Daigle <a href="http://www.ryandaigle.com/articles/2006/5/24/continuous-integration-w-rails">suggests</a> to use a separate <code>build</code> environment to keep the build away from the rest of your application. This sort of repelled me from Continuous Builder since it also needs a database to work this way.</p></li>
<li><p><strong>The Hell-Hound</strong>: <a href="http://cerberus.rubyforge.org/">Cerberus</a><br>
It&#39;s simple and easy to use, it comes as a RubyGem and is up and running in no time. Once installed, projects are added through the <code>cerberus</code> command.<br>
<code>cerberus add http://some.server/with/my/svn/trunk</code></p>

<p>By default, it uses the last part of your Subversion URL to create a name for your project, so you might want to add the option <code>APPLICATION_NAME=&lt;my_project&gt;</code> to specify a nicer name than just trunk.</p>

<p>When you&#39;re done you can easily build your project with <code>cerberus build &lt;my_project&gt;</code>. Cerberus will check for changes in your repository and only do its magic when there are changes. It supports notification through email (duh), Jabber, RSS, CampFire and IRC. It can be run as a commit hook or as a cron job.</p></li>
<li><p><strong>The Classic</strong>: <a href="http://cruisecontrolrb.thoughtworks.com/">CruiseControl.rb</a><br>
Of course I didn&#39;t discover it until Cerberus was up and running. CruiseControl.rb is the natural evolution that eventually had to come after CruiseControl, the bigger brother of the Java world. Both are products of ThoughtWorks.</p>

<p>CruiseControl.rb is, of course, a Rails application. It doesn&#39;t need a database though. It&#39;s pretty easy to use. You just unpack it, add a project and start the required processes:</p>

<p><code>cruise add my_project http://some.server/with/my/svn/trunk</code><br>
<code>cruise start</code></p>

<p>That&#39;s about it. After that you can point your browser to the dashboard application and enjoy the magic of freshly made builds.</p>

<p>Downsides include support for a wider variety of version control systems. For now, only Subversion is on the list.</p></li>
</ul>

<p>All of the above are pretty neat and depending on your continuous integration needs, can be recommended. If you need a fancy web application, there&#39;s no way around CruiseControl.rb. Its clear advantage is also that it polls the repository without needing cron or a commit hook. Otherwise I&#39;d recommend Cerberus over Continuous Builder because it&#39;s a little bit more flexible and offers more notification options. What I realised is that even in a Rails project where the tests are mainly the proof that code hasn&#39;t been broken with a change, it&#39;s necessary to check this automatically. No more &quot;But it works on my machine&quot; and that warm, fuzzy feeling of not getting email after you checked in.</p>

      </div>
      <div class="item_meta">
        <span class="item_tags">
          Tags: 
          
        </span>
      </div>
    </div>
  </article>

</div>

<div class="pagination">
  
    
      <a href="/page78" class="previous">Newer Posts</a>
    
  
  
    <a href="/page80" class="next">Older Posts</a>
  
</div>

       
        <div id="footer">
          <div id="footer_text">
            <a href="/archives.html">Archives</a>, <a href="http://www.paperplanes.de/rss.xml" title="Full-text RSS feed">RSS Feed</a>, &copy; 2007-2014 Mathias Meyer <a href="/imprint.html">Imprint</a>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46305173-1', 'paperplanes.de');
      ga('send', 'pageview');

    </script>
  </body>
  <script src="//my.hellobar.com/7db1d1ae6111ae95568efbbf8e6a1ee953ad854f.js" type="text/javascript" charset="utf-8" async="async"></script>
</html>
